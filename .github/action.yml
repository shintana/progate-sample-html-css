name: Mention Contributor and Reviewer
description: 'This action mention the contributor and reviewer for a pull request.'
    
outputs:
  contributorID:
    description: "Slack ID of contributor"
    value: ${{ steps.get-contributor-slack.outputs.contributorID }}
  reviewerIOS:
    description: "Reviewer of PIC iOS"
    value: ${{ steps.get-reviewer.outputs.reviewerIOS }}
  reviewerID:
    description: "Slack ID of reviewer"
    value: ${{ steps.get-reviewer-slack.outputs.reviewerID }}
  notif:
    description: "notif"
    value: ${{ steps.notif }}
    
runs:
  using: "composite"
  steps:
    - name: Get slack ID of contributor
      shell: bash
      id: get-contributor-slack
      run: |
        contributorID=$(echo "$(cat ./.github/test.json)" | jq '.contributor["${{ github.event.pull_request.user.login }}"]')
        echo "::set-output name=contributorID::${contributorID}"
    
    - name: Get reviewer of PIC iOS only
      shell: bash
      id: get-reviewer
      run: |
        reviewerIOS=$(echo "$(cat $GITHUB_EVENT_PATH)" | jq -r '.pull_request.requested_reviewers[] | ["kopimakpiti", "test"] as $pic | select(.login as $username | any ($pic[]; . == $username)) | {login} | join(" ")')
        echo "::set-output name=reviewerIOS::${reviewerIOS}"

    - name: Get slack ID of reviewer
      shell: bash
      id: get-reviewer-slack
      run: |
        reviewerID=$(echo "$(cat ./.github/test.json)" | jq '.reviewer["${{ steps.get-reviewer.outputs.reviewerIOS }}"]')
        echo "::set-output name=reviewerID::${reviewerID}"
        
    - name: notif
      shell: cmd
      id: notif
      run: |
        curl -i -X POST -H "Content-type:application/json" -H "Authorization: Bearer $SLACK_BOT_TOKEN" -d "{\"channel\":\"C02LV4R4X4Z\",\"blocks\": [{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"$pr_title <@$contributor>\"}},{\"type\":\"section\",\"fields\":[{\"type\":\"mrkdwn\",\"text\":\"*Reviewer*\"},{\"type\":\"mrkdwn\",\"text\":\"<@$reviewer>\"},{\"type\":\"mrkdwn\",\"text\":\"*Status*\"},{\"type\":\"mrkdwn\",\"text\":\""'`Need Approval`'"\"}]},{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"<$link | View Pull Request>\"}}]}" https://slack.com/api/chat.postMessage
 
