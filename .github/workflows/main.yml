# This is a basic workflow to help you get started with Actions

name: Slack Notifications

on:
  pull_request:
    types: [ labeled ]
    
jobs:
  notifySlack:
    runs-on: ubuntu-latest
    
    if: ${{ github.event.label.name == 'need-approval' }}
    steps:
      - uses: actions/checkout@v1
      - name: Check email of committed person
        uses: ./.github
        id: committed-slack-generator
        
      - name: Check reviewer of committed person
        uses: ./.github
        id: reviewer-generator
          
      - name: Mention author
        uses: pullreminders/slack-action@master
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
        with:
          args: '{\"channel\":\"C02LV4R4X4Z\",\"blocks\":[{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"${{ github.event.pull_request.title }} <@${{ steps.committed-slack-generator.outputs.slackid }}>\"}},{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"*Reviewer:* <@${{ steps.reviewer-generator.outputs.reviewer }}>\n*Status:* `Need Approval`\"}},{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"<${{ github.event.pull_request.html_url }}|View Pull Request>\"}}]}'
